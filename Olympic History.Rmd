---
title: "Project 1: Olmypic History Trend Analytics"
author: "Group 9 - Thomas George Thomas, Yang Liu, Pratyush Pothuneedi"
date: "10/28/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
#Importing Required packages
library(tidyverse)
library(reshape2)
library(dplyr)
library(knitr)

## Uncomment below to set the working directory.
##setwd("C:/Users/Docs")
```

# 1. Data Acquisition

## importing the datasets
```{r} 
# Data of the athelets and countries
atheletes_df <- read.csv('athlete_events.csv', header = TRUE, sep = ',')
head(atheletes_df, 5) # structure of the dataset
```

```{r}
# Importing Data of the regions tied with the NOC code
regions_df <- read.csv('noc_regions.csv', header= TRUE, sep =',')
head(regions_df, 5)
```

# 2. Data Wrangling

## 2.1 Data Discovery

### Summary Statistics

```{r}
summary(atheletes_df)
```
**We can see that there are NA's in the numerical fields of Age, Height, Weight which we will be handling**

```{r}
summary(regions_df)
```
### Discovering Discrete Data


```{r}
kable(
  atheletes_df %>%
    summarise(total_records=n()),
  caption = "Total Records for Athletes"
  
)
```



```{r}
kable(
  regions_df %>%
    summarise(total_records=n()),
  caption = "Total Records in Regions"
  
)
```

Looking for NA's in all the columns


```{r}
# Store the cols with missing values 
list_na <- colnames(atheletes_df)[apply(atheletes_df, 2, anyNA)]

```

We already knew that Age, Height & Weight have NA's as seen above in the summary. We found that categorical Medal's have NA, taking a closer look:


```{r}
kable(
  atheletes_df %>%
    group_by(Medal) %>%
    summarise(total_records=n())
    ,caption="Records by Medal Count"
  
)
```
```{r}

```



**We can see that there are 231333 NA's for Medals which happens to be categorical data and we need to handle this in the cleaning part**

## 2.2 Structuring

```{r}
head(atheletes_df,5)
```

**We can see that we don't need to do additional restructuring as columns like "Games" is already split and available as Year and Season**

## 2.3 Cleaning

### Handling Missing Data

**We can't filter out the NA values since the columns that exhibit them are required for our analysis. We will be filling the NA values in Age, Height, Weight with the median values and Medals with 'None'. Here, Medals with 'None' would signify that the athletes simply didn't win any of the categories of Medals (Gold, Silver, Bronze). We didn't filter out the NA records in Age, Height and Weight because that would mean that crucial data would be dropped leading to data skewness, we are using the Median values since we require whole numbers and to reduce the degree of skewness while maintaining data integrity**

Replacing NA's in Medals

```{r, results=FALSE}
atheletes_df$Medal <- atheletes_df$Medal %>% 
  replace_na("None") # It is assumed tha the athlete participated in the sport but didn't win a medal
```

Calculating Missing Median for the missing values for Age, Height and Weight

```{r}

list_na <- list_na[ list_na !="Medal"]

# Calculate median for the missing values
missing_median <- apply(atheletes_df[,colnames(atheletes_df) %in% list_na],
      2, # 2 is for Columns
      median,
      na.rm =  TRUE)
missing_median
```


```{r}
# Replace the missing values with median
atheletes_df <- atheletes_df %>%
   mutate(
     Age  = ifelse(is.na(Age), missing_median[1], Age),
     Height = ifelse(is.na(Height), missing_median[2], Height),
     Weight = ifelse(is.na(Weight), missing_median[3], Weight)
   )

head(atheletes_df,5)

```

## 2.4 Enriching

### Adding Attribute region

We will join regions_df and atheletes_df based on the NOC code to get the Country for enriching the data.


```{r}
athletes <- left_join(atheletes_df, regions_df, by="NOC")

# Replacing Region with Country to make the data more meaningful
colnames(athletes)[which(names(athletes) == "region")] <- "Country" 
# Removing notes since it's not relevant to our analysis
athletes <- athletes[,-17]
head(athletes,5)

```

**We don't have any other attribute to split or to create a new category since we believe that we have all the required columns for our analysis**

## 2.5 Validating

### Check for any missing values

```{r}

 # Counting the number of NA's for all the columns
 colnames(athletes)[apply(athletes, 2, anyNA)]

kable(
  athletes %>%
    group_by(Country) %>%
    summarise(total_records=n())
    ,caption="Records by Medal Count"
  
)

```

